define(function(e){function n(n,i,l){var u=this,s=e("./shape");e("./shape/circle"),e("./shape/ellipse"),e("./shape/line"),e("./shape/polygon"),e("./shape/brokenLine"),e("./shape/rectangle"),e("./shape/ring"),e("./shape/sector"),e("./shape/text"),e("./shape/heart"),e("./shape/droplet"),e("./shape/path"),e("./shape/image"),e("./shape/beziercurve"),e("./shape/star"),e("./shape/isogon");var d;if("undefined"==typeof l.shape)d=s;else{d={};for(var c in l.shape)d[c]=l.shape[c];d.get=function(e){return d[e]||s.get(e)}}var f=new t(d),h=new r(i,f,d),v=new o(i,f,h,d),p=e("./animation/animation"),g=[],m=new p({stage:{update:function(){u.update(g)}}});m.start(),u.getId=function(){return n},u.addShape=function(e){return f.add(e),u},u.delShape=function(e){return f.del(e),u},u.modShape=function(e,n){return f.mod(e,n),u},u.addHoverShape=function(e){return f.addHover(e),u},u.render=function(e){return h.render(e),u},u.refresh=function(e){return h.refresh(e),u},u.update=function(e,n){return h.update(e,n),u},u.resize=function(){return h.resize(),u},u.animate=function(n,t,r){var o=e("./tool/util"),i=f.get(n);if(i){var l;if(t){for(var u=t.split("."),s=i,d=0,c=u.length;d<c;d++)s&&(s=s[u[d]]);s&&(l=s)}else l=i;return l?("undefined"==typeof i.__aniCount&&(i.__aniCount=0),0===i.__aniCount&&g.push(i),i.__aniCount++,m.animate(l,r).done(function(){if(i.__aniCount--,0===i.__aniCount){var e=o.indexOf(g,i);g.splice(e,1)}})):void a.log('Property "'+t+'" is not existed in shape '+n)}a.log('Shape "'+n+'" not existed')},u.showLoading=function(e){return h.showLoading(e),u},u.hideLoading=function(){return h.hideLoading(),u},u.newShapeId=function(e){return f.newShapeId(e)},u.getWidth=function(){return h.getWidth()},u.getHeight=function(){return h.getHeight()},u.toDataURL=function(e,n){return h.toDataURL(e,n)},u.on=function(e,n){return v.on(e,n),u},u.un=function(e,n){return v.un(e,n),u},u.clear=function(){return f.del(),h.clear(),u},u.dispose=function(){m.stop(),m=null,g=null,u.clear(),u=null,f.dispose(),f=null,h.dispose(),h=null,v.dispose(),v=null,a.delInstance(n)}}function t(n){function t(e){e.hoverable||e.onclick||e.draggable||e.onmousemove||e.onmouseover||e.onmouseout||e.onmousedown||e.onmouseup||e.ondragenter||e.ondragover||e.ondragleave||e.ondrop?e.__silent=!1:e.__silent=!0,Math.abs(e.rotation[0])>1e-4||Math.abs(e.position[0])>1e-4||Math.abs(e.position[1])>1e-4||Math.abs(e.scale[0]-1)>1e-4||Math.abs(e.scale[1]-1)>1e-4?e.__needTransform=!0:e.__needTransform=!1,e.style=e.style||{},e.style.__rect=null}function r(e){return(e||"")+ ++y}function o(e){var n={shape:"circle",id:e.id||w.newShapeId(),zlevel:0,draggable:!1,clickable:!1,hoverable:!0,position:[0,0],rotation:[0,0,0],scale:[1,1,0,0]};return b.merge(n,e,{overwrite:!0,recursive:!0}),t(n),L[n.id]=n,M[n.zlevel]=M[n.zlevel]||[],M[n.zlevel].push(n),C=Math.max(C,n.zlevel),S[n.zlevel]=!0,w}function i(e){return L[e]}function l(e){if("undefined"!=typeof e){if(L[e]){S[L[e].zlevel]=!0;for(var n=M[L[e].zlevel],t=[],r=0,o=n.length;r<o;r++)n[r].id!=e&&t.push(n[r]);M[L[e].zlevel]=t,delete L[e]}}else L={},M=[],_=[],C=0,S={all:!0};return w}function u(e,n){var r=L[e];return r&&(S[r.zlevel]=!0,b.merge(r,n,{overwrite:!0,recursive:!0}),t(r),S[r.zlevel]=!0,C=Math.max(C,r.zlevel)),w}function s(e,t,r){var o=L[e];if(o.__needTransform=!0,!o.ondrift||o.ondrift&&!o.ondrift(o,t,r))if(a.catchBrushException)try{n.get(o.shape).drift(o,t,r)}catch(e){a.log(e,"drift error of "+o.shape,o)}else n.get(o.shape).drift(o,t,r);return S[o.zlevel]=!0,w}function d(e){return e.rotation&&Math.abs(e.rotation[0])>1e-4||e.position&&(Math.abs(e.position[0])>1e-4||Math.abs(e.position[1])>1e-4)||e.scale&&(Math.abs(e.scale[0]-1)>1e-4||Math.abs(e.scale[1]-1)>1e-4)?e.__needTransform=!0:e.__needTransform=!1,_.push(e),w}function c(){return _=[],w}function f(){return _.length>0}function h(e,n){if(n||(n={hover:!1,normal:"down"}),n.hover)for(var t=0,r=_.length;t<r;t++)if(e(_[t]))return w;var o,i;if("undefined"!=typeof n.normal)switch(n.normal){case"down":for(var r=M.length-1;r>=0;r--)if(o=M[r])for(i=o.length;i--;)if(e(o[i]))return w;break;case"up":for(var t=0,r=M.length;t<r;t++)if(o=M[t]){i=o.length;for(var a=0;a<i;a++)if(e(o[a]))return w}break;default:for(var t in L)if(e(L[t]))return w}return w}function v(){return C}function p(){return S}function g(){return S={},w}function m(e){return S[e]=!0,w}function E(){L=null,M=null,_=null,w=null}var b=e("./tool/util"),w=this,y=0,L={},M=[],_=[],C=0,S={};w.newShapeId=r,w.add=o,w.get=i,w.del=l,w.addHover=d,w.delHover=c,w.hasHoverShape=f,w.mod=u,w.drift=s,w.iterShape=h,w.getMaxZlevel=v,w.getChangedZlevel=p,w.clearChangedZlevel=g,w.setChangedZlevle=m,w.dispose=E}function r(n,t,r){function o(){var e=n.currentStyle||document.defaultView.getComputedStyle(n);return n.clientWidth-e.paddingLeft.replace(/\D/g,"")-e.paddingRight.replace(/\D/g,"")}function i(){var e=n.currentStyle||document.defaultView.getComputedStyle(n);return n.clientHeight-e.paddingTop.replace(/\D/g,"")-e.paddingBottom.replace(/\D/g,"")}function l(){N.innerHTML="",n.innerHTML="",R=o(),O=i(),N.style.position="relative",N.style.overflow="hidden",N.style.width=R+"px",N.style.height=O+"px",n.appendChild(N),H={},D={},V=t.getMaxZlevel(),H.bg=s("bg","div"),N.appendChild(H.bg);for(var e=0;e<=V;e++)H[e]=s(e,"canvas"),N.appendChild(H[e]),G_vmlCanvasManager&&G_vmlCanvasManager.initElement(H[e]),D[e]=H[e].getContext("2d"),1!=k&&D[e].scale(k,k);H.hover=s("hover","canvas"),H.hover.id="_zrender_hover_",N.appendChild(H.hover),G_vmlCanvasManager&&G_vmlCanvasManager.initElement(H.hover),D.hover=H.hover.getContext("2d"),1!=k&&D.hover.scale(k,k)}function u(){var e=t.getMaxZlevel();if(V<e){for(var n=V+1;n<=e;n++)H[n]=s(n,"canvas"),N.insertBefore(H[n],H.hover),G_vmlCanvasManager&&G_vmlCanvasManager.initElement(H[n]),D[n]=H[n].getContext("2d"),1!=k&&D[n].scale(k,k);V=e}}function s(e,n){var t=document.createElement(n);return t.style.position="absolute",t.style.width=R+"px",t.style.height=O+"px",t.setAttribute("width",R*k),t.setAttribute("height",O*k),t.setAttribute("data-id",e),t}function d(e){return function(n){if((e.all||e[n.zlevel])&&!n.invisible){var t=D[n.zlevel];if(t){if(!n.onbrush||n.onbrush&&!n.onbrush(t,n,!1))if(a.catchBrushException)try{r.get(n.shape).brush(t,n,!1,v)}catch(e){a.log(e,"brush error of "+n.shape,n)}else r.get(n.shape).brush(t,n,!1,v)}else a.log("can not find the specific zlevel canvas!")}}}function c(e){var n=D.hover;if(!e.onbrush||e.onbrush&&!e.onbrush(n,e,!0))if(a.catchBrushException)try{r.get(e.shape).brush(n,e,!0,v)}catch(n){a.log(n,"hoverBrush error of "+e.shape,e)}else r.get(e.shape).brush(n,e,!0,v)}function f(e){return w()&&b(),u(),t.iterShape(d({all:!0}),{normal:"up"}),t.clearChangedZlevel(),"function"==typeof e&&e(),x}function h(e){u();var n=t.getChangedZlevel();if(n.all)p();else for(var r in n)D[r]&&D[r].clearRect(0,0,R*k,O*k);return t.iterShape(d(n),{normal:"up"}),t.clearChangedZlevel(),"function"==typeof e&&e(),x}function v(e,n){for(var r,o=0,i=e.length;o<i;o++)r=e[o],t.mod(r.id,r);return h(n),x}function p(){for(var e in D)"hover"!=e&&D[e].clearRect(0,0,R*k,O*k);return x}function g(){return m(),t.iterShape(c,{hover:!0}),t.delHover(),x}function m(){return D&&D.hover&&D.hover.clearRect(0,0,R*k,O*k),x}function E(n){var r=e("./tool/loadingEffect");return r.stop(T),n=n||{},n.effect=n.effect||z.loadingEffect,n.canvasSize={width:R,height:O},T=r.start(n,t.addHover,g),x.loading=!0,x}function b(){var n=e("./tool/loadingEffect");return n.stop(T),m(),x.loading=!1,x}function w(){return x.loading}function y(){return R}function L(){return O}function M(){var e,n,r;if(N.style.display="none",e=o(),n=i(),N.style.display="",R!=e||n!=O){R=e,O=n,N.style.width=R+"px",N.style.height=O+"px";for(var a in H)r=H[a],r.setAttribute("width",R),r.setAttribute("height",O),r.style.width=R+"px",r.style.height=O+"px";t.setChangedZlevle("all"),h()}return x}function _(){w()&&b(),n.innerHTML="",n=null,t=null,r=null,N=null,H=null,D=null,x=null}function C(){return H.hover}function S(e,n){if(G_vmlCanvasManager)return null;var o=s("image","canvas");H.bg.appendChild(o);var i=o.getContext("2d");1!=k&&i.scale(k,k),i.fillStyle="#fff",i.rect(0,0,R*k,O*k),i.fill(),t.iterShape(function(e){if(!e.invisible&&(!e.onbrush||e.onbrush&&!e.onbrush(i,e,!1)))if(a.catchBrushException)try{r.get(e.shape).brush(i,e,!1,v)}catch(n){a.log(n,"brush error of "+e.shape,e)}else r.get(e.shape).brush(i,e,!1,v)},{normal:"up"});var l=o.toDataURL(e,n);return i=null,H.bg.removeChild(o),l}var T,z=e("./config"),x=this,H={},D={},V=0,N=document.createElement("div");N.onselectstart=function(){return!1};var R,O,k=window.devicePixelRatio||1;x.render=f,x.refresh=h,x.update=v,x.clear=p,x.refreshHover=g,x.clearHover=m,x.showLoading=E,x.hideLoading=b,x.isLoading=w,x.getWidth=y,x.getHeight=L,x.resize=M,x.dispose=_,x.getDomHover=C,x.toDataURL=S,l()}function o(n,t,r,o){function i(){window.addEventListener?(window.addEventListener("resize",a),n.addEventListener("click",l),n.addEventListener("mousewheel",u),n.addEventListener("DOMMouseScroll",u),n.addEventListener("mousemove",s),n.addEventListener("mouseout",d),n.addEventListener("mousedown",h),n.addEventListener("mouseup",v),n.addEventListener("touchstart",p),n.addEventListener("touchmove",g),n.addEventListener("touchend",m)):(window.attachEvent("onresize",a),n.attachEvent("onclick",l),n.attachEvent("onmousewheel",u),n.attachEvent("onmousemove",s),n.attachEvent("onmouseout",d),n.attachEvent("onmousedown",h),n.attachEvent("onmouseup",v))}function a(e){V=e||window.event,G=null,Z=!1,R.dispatch(H.EVENT.RESIZE,V)}function l(e){V=S(e),G?G&&G.clickable&&_(G,H.EVENT.CLICK):_(G,H.EVENT.CLICK),s(V)}function u(e){V=S(e),_(G,H.EVENT.MOUSEWHEEL),s(V)}function s(e){r.isLoading()||(V=S(e),Y=W,B=P,W=O(V),P=k(V),E(),A=!1,t.iterShape(C,{normal:"down"}),A||((!I||G&&G.id!=I.id)&&(f(),y()),G=null,t.delHover(),r.clearHover()),I&&(t.drift(I.id,W-Y,P-B),t.addHover(I)),_(G,H.EVENT.MOUSEMOVE),(I||A||t.hasHoverShape())&&r.refreshHover(),I||A&&G.draggable?n.style.cursor="move":A&&G.clickable?n.style.cursor="pointer":n.style.cursor="default")}function d(e){V=S(e);var t=V.toElement||V.relatedTarget;if(t!=n)for(;t&&9!=t.nodeType;){if(t==n)return void s(e);t=t.parentNode}V.zrenderX=Y,V.zrenderY=B,n.style.cursor="default",Z=!1,f(),L(),M(),r.isLoading()||r.refreshHover()}function c(){_(G,H.EVENT.MOUSEOVER)}function f(){_(G,H.EVENT.MOUSEOUT)}function h(e){V=S(e),Z=!0,U=G,_(G,H.EVENT.MOUSEDOWN)}function v(e){V=S(e),n.style.cursor="default",Z=!1,U=null,_(G,H.EVENT.MOUSEUP),L(),M()}function p(e){D.stop(e),V=S(e,!0),N=new Date,h(V)}function g(e){D.stop(e),V=S(e,!0),s(V)}function m(e){D.stop(e),V=S(e,!0),v(V),r.clearHover(),new Date-N<H.EVENT.touchClickDelay&&(G=null,W=V.zrenderX,P=V.zrenderY,t.iterShape(C,{normal:"down"}),G||(W+=10,t.iterShape(C,{normal:"down"})),G||(W-=20,t.iterShape(C,{normal:"down"})),G||(W+=10,P+=10,t.iterShape(C,{normal:"down"})),G||(P-=20,t.iterShape(C,{normal:"down"})),G&&(V.zrenderX=W,V.zrenderY=P),l(V))}function E(){Z&&G&&G.draggable&&!I&&U==G&&(I=G,X=!0,I.invisible=!0,t.mod(I.id,I),_(I,H.EVENT.DRAGSTART),r.refresh())}function b(){I&&_(G,H.EVENT.DRAGENTER,I)}function w(){I&&_(G,H.EVENT.DRAGOVER,I)}function y(){I&&_(G,H.EVENT.DRAGLEAVE,I)}function L(){I&&(I.invisible=!1,t.mod(I.id,I),r.refresh(),_(G,H.EVENT.DROP,I))}function M(){I&&(_(I,H.EVENT.DRAGEND),G=null),X=!1,I=null}function _(e,n,t){var r="on"+n,o={type:n,event:V,target:e};t&&(o.dragged=t),e?e[r]&&e[r](o)||R.dispatch(n,V,o):t||R.dispatch(n,V)}function C(e){if(I&&I.id==e.id)return!1;if(e.__silent)return!1;var n=o.get(e.shape);return!!n.isCover(e,W,P)&&(e.hoverable&&t.addHover(e),G!=e&&(f(),y(),G=e,b()),c(),w(),A=!0,!0)}function S(e,t){if(t){V=e;var r="touchend"!=V.type?V.targetTouches[0]:V.changedTouches[0];r&&(V.zrenderX=r.clientX-n.offsetLeft+document.body.scrollLeft,V.zrenderY=r.clientY-n.offsetTop+document.body.scrollTop)}else{V=e||window.event;var o=V.toElement||V.relatedTarget||V.srcElement||V.target;o&&o!=K&&(V.zrenderX=("undefined"!=typeof V.offsetX?V.offsetX:V.layerX)+o.offsetLeft,V.zrenderY=("undefined"!=typeof V.offsetY?V.offsetY:V.layerY)+o.offsetTop)}return V}function T(e,n){return R.bind(e,n),R}function z(e,n){return R.unbind(e,n),R}function x(){window.removeEventListener?(window.removeEventListener("resize",a),n.removeEventListener("click",l),n.removeEventListener("mousewheel",u),n.removeEventListener("DOMMouseScroll",u),n.removeEventListener("mousemove",s),n.removeEventListener("mouseout",d),n.removeEventListener("mousedown",h),n.removeEventListener("mouseup",v),n.removeEventListener("touchstart",p),n.removeEventListener("touchmove",g),n.removeEventListener("touchend",m)):(window.detachEvent("onresize",a),n.detachEvent("onclick",l),n.detachEvent("onmousewheel",u),n.detachEvent("onmousemove",s),n.detachEvent("onmouseout",d),n.detachEvent("onmousedown",h),n.detachEvent("onmouseup",v)),n=null,K=null,t=null,r=null,o=null,z(),R=null}var H=e("./config"),D=e("./tool/event");D.Dispatcher.call(this);var V,N,R=this,O=D.getX,k=D.getY,A=!1,G=null,U=null,I=null,Z=!1,X=!1,Y=0,B=0,W=0,P=0,K=r.getDomHover();R.on=T,R.un=z,R.dispose=x,i()}e("./lib/excanvas");var i={},a=i,l=0,u={};return i.init=function(e,t){var r=new n(++l+"",e,t||{});return u[l]=r,r},i.dispose=function(e){if(e)e.dispose();else{for(var n in u)u[n].dispose();u={}}return i},i.getInstance=function(e){return u[e]},i.delInstance=function(e){return u[e]&&(u[e]=null,delete u[e]),i},i.catchBrushException=!1,i.debugMode=0,i.log=function(){if(0!==i.debugMode){if(1==i.debugMode)for(var e in arguments)throw new Error(arguments[e]);else if(i.debugMode>1)for(var e in arguments)console.log(arguments[e]);return i}},i});
//# sourceMappingURL=zrender.min.js.map